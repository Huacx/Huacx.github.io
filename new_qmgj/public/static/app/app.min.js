var app = angular.module('qmgj_unlogin',['ui.router','ui.bootstrap']);
app.config(['$stateProvider','$urlRouterProvider',function($stateProvider,$urlRouterProvider){
	$urlRouterProvider.otherwise('/home');
	$stateProvider.state('home',{
		url:'/home',
		templateUrl:'static/app/view/homeView.html',
		controller:'homeViewController'
	}).state('login',{
		url:'/login',
		templateUrl:'static/app/view/loginView.html',
		controller:'loginViewController'
	}).state('register',{
		url:'/register',
		templateUrl:'static/app/view/registerView.html',
		controller:'registerViewController'
	}).state('list',{
		url:'/list',
		templateUrl:'static/app/view/listView.html',
		controller:'listViewController'
	}).state('list2',{
		url:'/list/:searchVal',
		templateUrl:'static/app/view/listView.html',
		controller:'listViewController'
	})
}])

app.filter('substr',function(){
	return function(){
		var val = arguments[0],
			start = arguments[1],
			count = arguments[2];
		// {{'12334'|substr:4}}
		if(count == undefined){
			count = arguments[1];
			start = 0;
		}
		// {{'12334'|substr}}
		if(start == undefined){
			start = 0;
			count = val.length;
		}
		return val.substr(start,count);

	}
})
app.filter('formatData',function(){
	var curDate = '';
	return function(lastTime){
		var hours = new Date(parseInt(lastTime)).getHours();
		if( hours>=3 && hours < 6 ){
			curDate = '凌晨好';
		}
		else if( hours>=6 && hours < 11 ){
			curDate = '上午好';
		}
		else if( hours>=11 && hours < 14 ){
			curDate = '中午好';
		}
		else if( hours>=14 && hours < 18 ){
			curDate = '下午好';
		}
		else if( hours>=18 && hours < 22 ){
			curDate = '晚上好';
		}
		else{
			curDate = '夜晚好';
		}
		return curDate;
	}
})
var app2 = angular.module('qmgj_login',['ui.router','ui.bootstrap']);
app2.config(['$stateProvider','$urlRouterProvider',function($stateProvider,$urlRouterProvider){
	$urlRouterProvider.otherwise('/home');
	$stateProvider.state('home',{
		url:'/home',
		templateUrl:'static/app/view/homeView.html',
		controller:'homeViewController'
	}).state('vip',{
		url:'/vip',
		templateUrl:'static/app/view/vipView.html',
		controller:'vipViewController'
	}).state('vip.main',{
		url:'/main',
		templateUrl:'static/app/view/vip.mainView.html',
		controller:'vip.mainViewController'
	}).state('vip.info',{
		url:'/info',
		templateUrl:'static/app/view/vip.infoView.html',
		controller:'vip.infoViewController'
	}).state('vip.record',{
		url:'/record',
		templateUrl:'static/app/view/vip.recordView.html',
		controller:'vip.recordViewController'
	}).state('list',{
		url:'/list',
		templateUrl:'static/app/view/listView.html',
		controller:'listViewController'
	}).state('list2',{
		url:'/list/:searchVal',
		templateUrl:'static/app/view/listView.html',
		controller:'listViewController'
	})
}])



app2.controller('logoutController',['$scope','$http',function($scope,$http){
	$scope.userLogout = function(){
		$http({
			url:'/user/logout',
			method:'get',
		}).then(function(res){
			if(res.data.resultCode == '0000'){
				alert(res.data.resultMsg);
				location.reload();
			}
			else{
				alert(res.data.resultMsg);
			}
		})
	}
}])
app2.filter('substr',function(){
	return function(){
		var val = arguments[0],
			start = arguments[1],
			count = arguments[2];
		// {{'12334'|substr:4}}
		if(count == undefined){
			count = arguments[1];
			start = 0;
		}
		// {{'12334'|substr}}
		if(start == undefined){
			start = 0;
			count = val.length;
		}
		return val.substr(start,count);

	}
})
app2.filter('formatData',function(){
	var curDate = '';
	return function(lastTime){
		var hours = new Date(parseInt(lastTime)).getHours();
		if( hours>=3 && hours < 6 ){
			curDate = '凌晨好';
		}
		else if( hours>=6 && hours < 11 ){
			curDate = '上午好';
		}
		else if( hours>=11 && hours < 14 ){
			curDate = '中午好';
		}
		else if( hours>=14 && hours < 18 ){
			curDate = '下午好';
		}
		else if( hours>=18 && hours < 22 ){
			curDate = '晚上好';
		}
		else{
			curDate = '夜晚好';
		}
		return curDate;
	}
})
app.controller('homeViewController', ['$scope', '$http', '$interval', function($scope, $http, $interval) {
    $scope.hotArr = ['全部', '微电影', '电视剧', '话剧', '电影', '戏曲', '书画', '相声', '戏剧', '音乐剧'];
    var home = {
        init: function() {
            this.getData();
        },
        getData: function() {
            var that = this;
            $http({
                url: '/IndexInfo',
                type: 'get',
            }).then(function(res) {
                if (res.data.resultCode == '0000') {
                    var data = res.data.result;
                    console.log(data);

                    slideData = data.slides;
                    $scope.hotData = data.hot;
                    $scope.newData = data.new;
                    $scope.unitData = data.unit;

                    that.dealSlide(slideData);
                    that.dealNew($scope.hotData);
                    that.dealHot($scope.newData);
                    that.dealUnit($scope.unitData);
                }
            })
        },
        dealSlide: function(slideData) {
            var showIndex = 0;
            $scope.showIndex = showIndex;
            var timer = '';
            $scope.slideData = slideData;
            startMove();
            if (timer) {
                $interval.cancel(timer);
            }
            timer = $interval(startMove, 1500);

            function startMove() {
                showIndex++;
                if (showIndex == $scope.slideData.length) {
                    showIndex = 0;
                }
                $scope.showIndex = showIndex;
                $scope.imgUrl = $scope.slideData[showIndex].img;
            }
            $scope.pauseSlide = function(index) {
                $interval.cancel(timer);
                $scope.showIndex = index;
                $scope.imgUrl = $scope.slideData[index].img;
            }
            $scope.playSlide = function() {
                timer = $interval(startMove, 1500);
            }
        },
        dealHot: function(hotData) {
            $scope.hotIndex = 0;
            $scope.showHotItem = function(index) {
                $scope.hotIndex = index;
            }
        },
        dealNew: function(newData) {},
        dealUnit: function(unitData) {},
    }
    home.init();
}])
app2.controller('homeViewController', ['$scope', '$http', '$interval', function($scope, $http, $interval) {
    $scope.hotArr = ['全部', '微电影', '电视剧', '话剧', '电影', '戏曲', '书画', '相声', '戏剧', '音乐剧'];
    var home = {
        init: function() {
            this.getData();
        },
        getData: function() {
            var that = this;
            $http({
                url: '/IndexInfo',
                type: 'get',
            }).then(function(res) {
                if (res.data.resultCode == '0000') {
                    var data = res.data.result;
                    console.log(data);

                    slideData = data.slides;
                    $scope.hotData = data.hot;
                    $scope.newData = data.new;
                    $scope.unitData = data.unit;

                    that.dealSlide(slideData);
                    that.dealNew($scope.hotData);
                    that.dealHot($scope.newData);
                    that.dealUnit($scope.unitData);
                }
            })
        },
        dealSlide: function(slideData) {
            var showIndex = 0;
            $scope.showIndex = showIndex;
            var timer = '';
            $scope.slideData = slideData;
            startMove();
            if (timer) {
                $interval.cancel(timer);
            }
            timer = $interval(startMove, 1500);

            function startMove() {
                showIndex++;
                if (showIndex == $scope.slideData.length) {
                    showIndex = 0;
                }
                $scope.showIndex = showIndex;
                $scope.imgUrl = $scope.slideData[showIndex].img;
            }
            $scope.pauseSlide = function(index) {
                $interval.cancel(timer);
                $scope.showIndex = index;
                $scope.imgUrl = $scope.slideData[index].img;
            }
            $scope.playSlide = function() {
                timer = $interval(startMove, 1500);
            }
        },
        dealHot: function(hotData) {
            $scope.hotIndex = 0;
            $scope.showHotItem = function(index) {
                $scope.hotIndex = index;
            }
        },
        dealNew: function(newData) {},
        dealUnit: function(unitData) {},

    }
    home.init();
}])

app.controller('listViewController', ['$scope', '$http','$stateParams', function($scope, $http,$stateParams) {
    $scope.typeList = ['全部', '微电影', '电视剧', '话剧', '电影', '戏曲', '书画', '相声', '戏剧', '音乐剧', '其它'];
    var list = {
        init: function() {
            $scope.page = 1;
            $scope.countAll = 0;
            $scope.count = 9;
            $scope.cid = 0;
            $scope.status = 0;
            $scope.timeStatus = 0;
            $scope.maxSize = 6;
            $scope.keyword = '';
            // console.log($stateParams.searchVal);
            if($stateParams.searchVal != ''){
            	console.log($stateParams.searchVal);
            	$scope.keyword = $stateParams.search;
            }
            this.getListData();
            this.events();
        },
        getListData: function() {
            $http({
                url: '/prolist',
                method: 'get',
                params: {
                    keyword: '',
                    cid: 0,
                    status: 0,
                    timeStatus: 0,
                    page: 1,
                    count: 9,
                }
            }).then(function(res) {
                if (res.data.resultCode == '0000') {
                    var dataList = res.data.result;
                    $scope.dataList = dataList.list;
                    console.log(res.data.result);
                    $scope.count = dataList.count;
                    $scope.countAll = dataList.countAll;
                } else {
                    alert(res.data.resultMsg);
                }
            })
        },
        events: function() {
        	var that = this;
        	$scope.changeType = function(index){
        		$scope.cid = index;
        		$scope.page = 1;
        		that.getListData();
        	}
        	$scope.changeStatus = function(index){
        		$scope.status = index;
        		$scope.page = 1;
        		that.getListData();
        	}
        	$scope.checkTimeStatus = function(index){
        		$scope.timeStatus = index;
        		$scope.page = 1;
        		that.getListData();
        	}
        	$scope.pageChanged = function(){
        		that.getListData();
        	}
        }
    }
    list.init();
}])
app2.controller('listViewController', ['$scope', '$http','$stateParams', function($scope, $http,$stateParams) {
    $scope.typeList = ['全部', '微电影', '电视剧', '话剧', '电影', '戏曲', '书画', '相声', '戏剧', '音乐剧', '其它'];
    var list = {
        init: function() {
            $scope.page = 1;
            $scope.countAll = 0;
            $scope.count = 9;
            $scope.cid = 0;
            $scope.status = 0;
            $scope.timeStatus = 0;
            $scope.maxSize = 6;
            $scope.keyword = '';
            if($stateParams.searchVal != ''){
            	$scope.keyword = $stateParams.search;
            }
            this.getListData();
            this.events();
        },
        getListData: function() {
            $http({
                url: '/prolist',
                method: 'get',
                params: {
                    keyword: '',
                    cid: 0,
                    status: 0,
                    timeStatus: 0,
                    page: 1,
                    count: 9,
                }
            }).then(function(res) {
                if (res.data.resultCode == '0000') {
                    var dataList = res.data.result;
                    $scope.dataList = dataList.list;
                    console.log(res.data.result);
                    $scope.count = dataList.count;
                    $scope.countAll = dataList.countAll;
                } else {
                    alert(res.data.resultMsg);
                }
            })
        },
        events: function() {
        	var that = this;
        	$scope.changeType = function(index){
        		$scope.cid = index;
        		$scope.page = 1;
        		that.getListData();
        	}
        	$scope.changeStatus = function(index){
        		$scope.status = index;
        		$scope.page = 1;
        		that.getListData();
        	}
        	$scope.checkTimeStatus = function(index){
        		$scope.timeStatus = index;
        		$scope.page = 1;
        		that.getListData();
        	}
        	$scope.pageChanged = function(){
        		that.getListData();
        	}
        }
    }
    list.init();
}])

app.controller('loginViewController',['$scope','$http',function($scope,$http){
	var login = {
		init:function(){
			this.events();
		},
		events:function(){
			$scope.loginClick = function(){
				if($scope.myform.$valid){
					$http({
						url:'/user/login',
						method:'post',
						data:{
							phone:$scope.phone,
							password:$scope.pwd
						}
					}).then(function(res){
						console.log(res.data);
						if(res.data.resultCode == '0000'){
							alert('登录成功');
							location.reload();
						}
					})
				}
			}
		}
	}
	login.init();
}])
app.controller('registerViewController', ['$scope', '$http', '$state',function($scope, $http,$state) {
    // if ($scope.myform.$valid) {
        $scope.regClick = function() {
            $http({
                url: '/user/reg',
                method: 'post',
                data: {
                    name: $scope.username,
                    phone: $scope.phone,
                    password: $scope.pwd,
                    passwordRepeat: $scope.pwd2
                }
            }).then(function(res) {
                if (res.data.resultCode == '0000') {
                	alert('注册成功');
                    $state.go('login');
                }
                else{
                	alert(res.data.resultMsg);
                }
            })
        }
    // }
}])

app.controller('searchController',['$scope','$state',function($scope,$state){
    $scope.myKeyPress = function(ev) {
        if(ev.keyCode == 13){
        	$state.go('list2',{searchVal:ev.target.value});
        }
    }
}])
app2.controller('searchController',['$scope','$state',function($scope,$state){
    $scope.myKeyPress = function(ev) {
        if(ev.keyCode == 13){
        	$state.go('list2',{searchVal:ev.target.value});
        }
    }
}])
app2.controller('vip.infoViewController',['$scope','$http',function($scope,$http){
	$scope.circleArr = ['微电影','电视剧','话剧','电影','戏曲','书画','相声','戏剧','音乐剧','其它'];
	$scope.checkbox = function(ev){
		console.log(ev);
		var liEle = angular.element(ev.target);
		$scope.careIndex =liEle.attr('data-value');
		liEle.toggleClass('active');
	}
	$scope.radio = function(ev){
		angular.element(ev.target).parent().children().removeClass('active');
		angular.element(ev.target).addClass('active');
	}
	$scope.submit = function(){
		alert('保存成功');
	}
}])
app2.controller('vip.mainViewController',['$scope','$http',function($scope,$http){
	$http({
		url:'/user/pros',
		method:'get'
	}).then(function(res){
		if(res.data.resultCode == '0000'){
			$scope.proCareData = res.data.result.procare;
			$scope.proHotData = res.data.result.prohot;
		}
		else{
			alert(res.data.resultMsg);
		}
	})
}])
app2.controller('vip.recordViewController', ['$scope', '$http', function($scope, $http) {
    var record = {
        init: function() {
            $scope.countAll = 0;
            $scope.count = 6;
            $scope.page = 1;
            $scope.maxSize = 6;
            $scope.type = 0;
            this.getData();
            this.events();
        },
        getData: function() {
            $http({
                url: '/user/RecordList',
                method: 'post',
                data: {
                    type: $scope.type,
                    page: $scope.page,
                    count: $scope.count
                }
            }).then(function(res){
            	console.log(res.data.result);
            	if(res.data.resultCode == '0000'){
	            	$scope.recordListData = res.data.result.list;
					$scope.countAll = res.data.result.count; 
            	}
            	else{
            		alert(res.data.resultMsg);
            	}
            })
        },
        events: function() {
        	var that = this;
		    $scope.changeType = function(index) {
		        $scope.type = index;
		        $scope.page=1;
		        that.getData();
		    }
		    $scope.pageChanged = function(){
		        that.getData();
		    }

        }
    }
    record.init();
}])

app2.controller('vipViewController',['$scope','$http',function($scope,$http){
	$http({
		url:'/user/info',
		method:'post',
	}).then(function(res){
		if(res.data.resultCode){
			$scope.infoData = res.data.result;
			console.log($scope.infoData);
		}
	})
}])